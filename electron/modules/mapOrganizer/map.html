<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; style-src 'self' 'unsafe-inline' https://unpkg.com https://cdnjs.cloudflare.com; script-src 'self' https://unpkg.com https://cdnjs.cloudflare.com; img-src 'self' data: https: blob:;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Map Organizer | Shamal Tools</title>
  <link rel="stylesheet" href="./map.css" />
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet Draw CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
</head>

<body>
  <div class="page">
    <div class="top-bar">
      <div class="header-left">
        <a class="back icon-btn ghost" href="../../renderer/index.html" aria-label="Back to dashboard">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6" />
            </svg>
          </span>
        </a>
        <div class="titles">
          <p class="eyebrow">Shamal Tools</p>
          <h1>Map Organization Tool</h1>
          <p class="subtitle">Visualize and organize images on a map</p>
        </div>
      </div>
    </div>

    <div class="actions-bar">
      <div class="actions-left">
        <div class="folder-path-display">
          <span class="muted small">Selected folder:</span>
          <span id="folderPathText" class="folder-path-value">No folder selected</span>
        </div>
        <div class="statistics">
          <span class="stat-item">Total Images: <span id="totalImagesCount">0</span></span>
          <span class="stat-item">Selected: <span id="selectedCount">0</span></span>
        </div>
      </div>
      <div class="actions">
        <button id="selectFolderBtn" class="ghost icon-btn">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7h6l2 2h10v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z" />
            </svg>
          </span>
          Select Image Folder
        </button>
        <button id="loadImagesBtn" class="ghost icon-btn" disabled>
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
            </svg>
          </span>
          Load Images
        </button>
        <button id="importKmlBtn" class="ghost icon-btn">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16v4H4z" />
              <path d="M4 12h16v8H4z" />
              <path d="M8 12V8" />
              <path d="M12 12V8" />
              <path d="M16 12V8" />
            </svg>
          </span>
          Import KML
        </button>
        <button id="exportImagesBtn" class="primary icon-btn">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12l5 5L20 7" />
            </svg>
          </span>
          Export Selected Images
        </button>
        <button id="clearSelectionBtn" class="ghost icon-btn">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </span>
          Clear Selection
        </button>
      </div>
    </div>

    <div class="map-wrapper">
      <style>
        .map-layout {
          display: flex;
          gap: 12px;
          height: 100%;
          min-height: 0;
        }

        .map-area {
          flex: 0 0 70%;
          min-width: 0;
          position: relative;
          height: 100%;
        }

        .map-layout .polygon-panel {
          position: static;
          width: 30%;
          max-width: none;
          max-height: none;
          height: 100%;
          min-width: 260px;
          display: flex;
          flex-direction: column;
          z-index: 1;
        }

        .map-layout .polygon-table {
          flex: 1;
          min-height: 0;
        }

        .map-layout .polygon-list {
          max-height: none;
          min-height: 0;
          flex: 1;
        }

        @media (max-width: 900px) {
          .map-layout {
            flex-direction: column;
          }

          .map-area,
          .map-layout .polygon-panel {
            width: 100%;
            min-width: 0;
          }

          .map-area {
            height: 60vh;
          }

          .map-layout .polygon-panel {
            height: auto;
          }
        }
      </style>
      <div class="map-layout">
        <div class="map-area">
          <div id="map"></div>
        </div>
        <div class="polygon-panel" id="polygonPanel">
          <div class="panel-head">
            <div class="panel-title">
              <p class="eyebrow">Polygons</p>
              <h3>Polygon Manager</h3>
              <p class="panel-subtext">Select which shapes export images, fine-tune colors, and toggle visibility.</p>
            </div>
            <div class="panel-stats">
              <span class="chip chip-neutral">
                <span class="dot dot-neutral" aria-hidden="true"></span>
                <span id="polygonCount">0</span> total
              </span>
              <span class="chip chip-accent">
                <span class="dot dot-accent" aria-hidden="true"></span>
                <span id="polygonSelectedCount">0</span> export
              </span>
              <span class="chip chip-muted">
                <span class="dot dot-muted" aria-hidden="true"></span>
                <span id="polygonHiddenCount">0</span> hidden
              </span>
            </div>
          </div>
          <div class="polygon-table">
            <div class="polygon-table-head">
              <span class="poly-col poly-col-export">Export</span>
              <span class="poly-col poly-col-name">Name</span>
              <span class="poly-col poly-col-color">Color</span>
              <span class="poly-col poly-col-visibility">Visibility</span>
            </div>
            <div id="polygonList" class="polygon-list">
              <div class="polygon-empty">No polygons yet. Draw a polygon or rectangle to get started.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet Draw JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <script src="./map.js"></script>
</body>

</html>